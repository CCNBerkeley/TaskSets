<!doctype html>
<html>
  <head>
    <title>Aliens</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="jspsych-5.0.3/jspsych.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-text.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-categorize.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-survey-text.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-alien-instructions.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-categorize-alienzzz2.js"></script>
    <link href="jspsych-5.0.3/css/jspsych.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body>
  </body>

  <script>

  /* TDs
  - instructions: use example trial in stead of hard-coded slides?
  - better reward schedule (right now, contexts can be recognized just because of the amounts)
  - read the novelty paper with the crops and planets -> similar?
  - add the other levels
  - record data
  - CHECK mouse instead of keys
  - CHECK add for SubjectID, etc.
  */

    var get_subj_data = {
      type: "survey-text",
      questions: ["SubjID:", "Date of birth (mm/dd/yyyy):", "Occupation:", "Highest degree:"]
    }

    alien_top = 230
    alien_height = 250
    below_aliens = alien_top + alien_height + 50
    sad_top = [alien_top + 100, alien_top + 50, alien_top]
    sad_left = [530, 810, 1100]
    reward_top = sad_top[0] - 27
    reward_left = sad_left[0] + 15
    button_top = alien_top + alien_height + 200
    button_height = 90
    border_height = button_height + 20
    button_dist = 50
    button1_left = 650
    button2_left = button1_left + button_height + button_dist
    button3_left = button2_left + button_height + button_dist
    button4_left = button3_left + button_height + button_dist
    below_buttons = button_top + button_height + 50

    /* define welcome message block */
    var bed = "<img src='img/bed.png' style='position:absolute; top:" + button_top + "px; left:" + button1_left + "px' height=" + button_height + ">"
    var umbrella = "<img src='img/umbrella.png' style='position:absolute; top:" + button_top + "px; left:" + button2_left + "px' height=" + button_height + ">"
    var plant = "<img src='img/plant.png' style='position:absolute; top:" + button_top + "px; left:" + button3_left + "px' height=" + button_height + ">"
    var rock = "<img src='img/rock.png' style='position:absolute; top:" + button_top + "px; left:" + button4_left + "px' height=" + button_height + ">"
    var response_buttons = bed + umbrella + plant + rock

    var highlight_bed = "<img src='img/border.png' style='position:absolute; top:" + button_top +
                              "px; left:" + button1_left + "px;' height=" + border_height + " width=" + border_height + " >"

    var aliens = "<img src='img/Aliens1.png' height=" + alien_height + ">"
    var aliens_abs = "<img src='img/Aliens1.png' style='position:absolute; top:" + alien_top + "px', height=" + alien_height + ">"
    var sadness0 = "<img src='img/sad.png' style='position:absolute; top:" + sad_top[0] + "px; left:" + sad_left[0] + "px;' height=120 >"
    var happiness0 = "<img src='img/happy2.png' style='position:absolute; top:" + sad_top[0] + "px; left:" + sad_left[0] + "px;' height=120 >"
    var happiness1 = "<img src='img/happy2.png' style='position:absolute; top:" + sad_top[1] + "px; left:" + sad_left[1] + "px;' height=120 >"
    var happiness2 = "<img src='img/happy2.png' style='position:absolute; top:" + sad_top[2] + "px; left:" + sad_left[2] + "px;' height=120 >"
    var number_feedback = "<p style='color:green; font-size:46px; position:absolute; top:" + reward_top + "px; left:" + reward_left + "px;'> +5 </p>"

    var welcome_block = "<p>Welcome to the experiment. Press 'next' to begin.</p>"

    var instructions1 = "<p>In the following game, you will be taking care of three aliens. " +
      "The aliens live on a strange planet and your goal is to help them grow as fast as possible.</p>" +
      "<p>Each alien needs different things to thrive. " +
      "One alien might need to chew on a shiny rock in order grow, " +
      "whereas another might need to catch cosmic rays with its red umbrella.</p>" +
      "<p>Over time, you will learn what each alien needs in order to grow.</p>" +
      aliens

    var instructions2 = "<p>The aliensâ€™ planet goes through different seasons, " +
      "and aliens will need different things depending on these seasons.</p>" +
      "<p>For example, in order to grow, one alien might need to chew on a shiny rock in the hot season, " +
      "but it might need to sleep in a bed during the rainy season.</p>" +
      "There are three seasons on the aliens' planet: <i>hot, cold, and rainy</i>:" +
      "<img src='img/hot.png' hspace='20' height=" + alien_height + ">" +
      "<img src='img/cold.png' hspace='20' height=" + alien_height + ">" +
      "<img src='img/rainy.png' hspace='20' height=" + alien_height + ">"

    var instructions3 = "<p>Let's practice the game with these three aliens:</p>" +
      aliens +
      "<p>Try to make each one of them grow as much as you can, by learning what each one needs!</p>"

    var instructions4 = "<p>Whenever an alien needs something, it will call you, just like the green alien below:</p>" +
      aliens_abs + sadness0 +
      "<div style='position:absolute; top:" + below_aliens + "px;'" +
        "<p>When an alien is unhappy like this, you can offer it one of several things to cheer it up and help it grow.</p>" +
        "<p>How about a nap in the green bed? In the game, you'll be able to click on an item to offer it to the alien.</p>" +
        "<p>Let's pretend you offered the alien a nap in the green bed - click Next to see what happens.</p>" +
      "</div>" +
      response_buttons + highlight_bed

    var instructions5 = "<p> The green alien liked the nap a lot! It is all happy now and it grew by 5 centimeters! </p>" +
      aliens_abs + happiness0 + number_feedback +
      response_buttons + highlight_bed

    var instructions6 = "<p> When you are ready, you can press Next for a practice round of the game.</p>" +
      "<p>Press Previous if you'd like to review the instructions before you start.</p>" +
      aliens +
      "<p>Try to learn which item each alien likes to help them grow!</p>"

    var instructions = {
    type: 'alien-instructions',
    pages: [
        welcome_block,
        instructions1,
        instructions2,
        instructions3,
        instructions4,
        instructions5,
        instructions6
    ],
    show_clickable_nav: true,
    timing_post_trial: 200
}

    var training_block = {
      type: "categorize-alienzzz2",
      season: "training",
      stimulus: "img/Aliens1.png",
      feedback_amounts: [5, 5, 5],
      choices: [74, 75, 76, 186],
      data: {block: "training"},
      randomize_order: true,
      timing_response: 10000,
      timeout_message: "<p style='text-align:center; font-size:40px; z=10'>" +
                       "Please respond faster next time! </p>",
      timeline: [
        // {key_answer: 74, sad_alien: 0},
        // {key_answer: 75, sad_alien: 1},
        // {key_answer: 76, sad_alien: 2},
        // {key_answer: 74, sad_alien: 0},
        {key_answer: 75, sad_alien: 1},
        {key_answer: 76, sad_alien: 2}
      ]
    }

    var instructions7 = {
      type: "text",
      text: "<p> Great job! You helped these three aliens grow a lot! </p>" +
      aliens_abs + happiness0 + happiness1 + happiness2 +
      response_buttons +
      "<div style='position:absolute; top:" + below_buttons + "px;'>" +
        "<p> Let's move on the real game now! </p>" +
        "<p> This time, you'll be on the aliens' planet, so the seasons will change! " +
        "Keep in mind that the aliens' preferences change with the seasons! </p>" +
      "</div>"
    }

    var hot_season = {
      season: "hot",
      feedback_amounts: [3, 2, 1],
      randomize_order: true,
      timeline: [
        {key_answer: 76, sad_alien: 0},
        {key_answer: 75, sad_alien: 1},
        {key_answer: 74, sad_alien: 2},
        {key_answer: 76, sad_alien: 0},
        {key_answer: 75, sad_alien: 1},
        {key_answer: 74, sad_alien: 2}
      ]
    }
    var cold_season = {
      season: "cold",
      feedback_amounts: [5, 4, 6],
      randomize_order: true,
      timeline: [
        {key_answer: 74, sad_alien: 0},
        {key_answer: 76, sad_alien: 1},
        {key_answer: 75, sad_alien: 2},
        {key_answer: 74, sad_alien: 0},
        {key_answer: 76, sad_alien: 1},
        {key_answer: 75, sad_alien: 2}
      ]
    }
    var rainy_season = {
      season: "rainy",
      feedback_amounts: [7, 9, 8],
      randomize_order: true,
      timeline: [
        {key_answer: 75, sad_alien: 0},
        {key_answer: 74, sad_alien: 1},
        {key_answer: 76, sad_alien: 2},
        {key_answer: 75, sad_alien: 0},
        {key_answer: 74, sad_alien: 1},
        {key_answer: 76, sad_alien: 2}
      ]
    }

    var all_seasons = {
      type: "categorize-alienzzz2",
      stimulus: "img/Aliens2.png",
      choices: [74, 75, 76, 186],
      timing_response: 3000,
      timeout_message: "<p style='text-align:center; font-size:40px; z=10'>" +
                       "Please respond faster next time! </p>",
      timeline: [
        hot_season,
        cold_season,
        rainy_season
      ]
    }

    var goodbye = {
      type: "text",
      text: "The game is now over, you did a great job! Thank you for participating in the experiment!"
    }

    /* create experiment timeline array */
    var timeline = [];
    timeline.push(get_subj_data);
    timeline.push(instructions);
    timeline.push(training_block, training_block);//, training_block, training_block, training_block, training_block, training_block, training_block, training_block);
    timeline.push(instructions7);
    timeline.push(all_seasons);
    timeline.push(goodbye);

    function download_data(data) {
      var csvString = jsPsych.data.dataAsCSV();
      var a         = document.createElement('a');
      a.href        = 'data:attachment/csv,' + csvString;
      a.target      = '_blank';
      a.download    = 'ExperimentData.csv';

      document.body.appendChild(a);
      a.click();
    }

    /* start the experiment */
    jsPsych.init({
      timeline: timeline,
      // fullscreen: true,
      // show_progress_bar: true,  // doesn't work when I have a background..
      on_finish: function(data) {download_data(data)}
      // on_finish: function(data){ saveData("filename.csv", jsPsych.data.dataAsCSV()) },  // only works on server and with PHP script
      // on_finish: function() { jsPsych.data.displayData() };  // doesn't work here, but after each trial
    });

  </script>
</html>
