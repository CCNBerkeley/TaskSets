<!doctype html>
<html>
  <head>
    <title>Aliens</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="jspsych-5.0.3/jspsych.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-text.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-categorize.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-survey-text.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-instructions.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-categorize-alienzzz2.js"></script>
    <link href="jspsych-5.0.3/css/jspsych.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body>
  </body>

  <script>

  /* TDs
  - better reward schedule (right now, contexts can be recognized just because of the amounts)
  - draw rewards from distribution
  - add counter
  - read the novelty paper with the crops and planets -> similar?
  - add the other levels
  - pseudo-randomize season order
  - make sure background comes on before aliens
  - CHECK only 3 actions
  - CHECK record data
  - CHECK mouse instead of keys
  - CHECK instructions: use example trial in stead of hard-coded slides?
  - CHECK add for SubjectID, etc.
  - CHECK display only one alien at a time
  - CHECK permute response buttons each time
  */

    var alien_height = 240
    var alien_height_point_counter = 60
    var sad_lefts = [0, 280, 520]
    var sad_left = 260
    var reward_top = - 27
    var reward_left = sad_left + 15
    var button_height = 50

    bed_button =
      "<button id='bed-button'" +
        "class='jspsych-btn'>" +
        "<img src='img/bed.png' height=" + button_height + ">" +
      "</button>"
    umbrella_button =
      "<button id='umbrella-button'" +
        "class='jspsych-btn'>" +
        "<img src='img/umbrella.png' height=" + button_height + ">" +
      "</button>"
    plant_button =
      "<button id='plant-button'" +
        "class='jspsych-btn'>" +
        "<img src='img/plant.png' height=" + button_height + ">" +
      "</button>"
    var buttons = [bed_button, umbrella_button, plant_button]

    function shuffle(array) {
      var currentIndex = array.length, temporaryValue, randomIndex;

      // While there remain elements to shuffle...
      while (0 !== currentIndex) {

        // Pick a remaining element...
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;

        // And swap it with the current element.
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
      }

      return array;
    }

    shuffled_buttons = shuffle(buttons)
    response_buttons =
      "<center><div class='response_buttons' style='position:relative; border: 100px solid transparent; z=10;'>" +
        shuffled_buttons[0] +
        shuffled_buttons[1] +
        shuffled_buttons[2] +
      "</div></center>"

    green_alien = "<img src='img/alien1.png'"
    purple_alien = "<img src='img/alien2.png'"
    red_alien = "<img src='img/alien3.png'"
    lblue_alien = "<img src='img/alien4.png'"
    orange_alien = "<img src='img/alien5.png'"
    dblue_alien = "<img src='img/alien6.png'"
    alien_array = [green_alien, purple_alien, dblue_alien]
    shuffled_aliens = shuffle(alien_array)

    var aliens =
      "<center><div style='position:relative; z=10;'>" +
        shuffled_aliens[0] + " height=" + alien_height + ">"
        shuffled_aliens[1] + " height=" + alien_height + ">"
        shuffled_aliens[2] + " height=" + alien_height + ">"
      "</div></center>"

    var speach = "<img src='img/speach.png' style='position:absolute; left:" + sad_left + "px;' height=120>"
    var exclamation_points = "<p style='color:red; position:absolute; left:" + reward_left + "px; top:" + reward_top + "px; font-size:46px;'> !!!!"
    var reward = "<p style='color:green; position:absolute; left:" + reward_left + "px; top:" + reward_top + "px; font-size:46px;'> +5"

    var sad_alien =
      "<center><div style='position:relative'>" +
        green_alien + speach + exclamation_points +
      "</div></center>"

    var happy_alien =
      "<center><div style='position:relative;'>" +
        green_alien + speach + reward +
      "</div></center>"

    var happy_aliens =
      "<center><div style='position:relative;'>" +
        shuffled_aliens[0] +
        shuffled_aliens[1] +
        shuffled_aliens[2] +
        "<img src='img/happy2.png' style='position:absolute; left:" + sad_lefts[0] + "px;' height=120>" +
        "<img src='img/happy2.png' style='position:absolute; left:" + sad_lefts[1] + "px;' height=120>" +
        "<img src='img/happy2.png' style='position:absolute; left:" + sad_lefts[2] + "px;' height=120>" +
      "</div></center>"

    var welcome_block = "<p>Welcome to the experiment. Click 'Next' or press the right arrow to begin.</p>"

    var get_subj_data = {
      type: "survey-text",
      questions: ["SubjID:", "Date of birth (mm/dd/yyyy):", "Occupation:", "Highest degree:"]
    }

    var instructions1 = "<center><p>In the following game, you will be taking care of three aliens. " +
      "The aliens live on a strange planet and your goal is to help them grow as fast as possible.</p>" +
      "<p>Each alien needs different things to thrive. " +
      "One alien might need to chew on a shiny rock in order grow, " +
      "whereas another might need to catch cosmic rays with its red umbrella.</p>" +
      "<p>Over time, you will learn what each alien needs in order to grow.</p></center>" +
      aliens

    var instructions2 = "<center><p>The aliensâ€™ planet goes through different seasons, " +
      "and aliens will need different things depending on these seasons.</p>" +
      "<p>For example, in order to grow, one alien might need to chew on a shiny rock in the hot season, " +
      "but it might need to sleep in a bed during the rainy season.</p>" +
      "There are three seasons on the aliens' planet: <i>hot, cold, and rainy</i>:" +
      "<img src='img/hot.png' style='border: 10px solid transparent;' height=" + alien_height + ">" +
      "<img src='img/cold.png' style='border: 10px solid transparent;' hspace='40' height=" + alien_height + ">" +
      "<img src='img/rainy.png' style='border: 10px solid transparent;' hspace='40' height=" + alien_height + "></center>"

    var instructions3 = "<center><p>Let's practice the game with these three aliens:</p>" +
      aliens +
      "<p>Try to make each one of them grow as much as you can, by learning what each one needs!</p></center>"

    var instructions4 = "<center><p>Whenever an alien needs something, it will call you, just like the green alien below:</p>" +
      sad_alien +
      "<div style='position:relative; top=50px'" +
        "<p>When an alien is unhappy like this green alien, you can offer it one of several things to cheer it up and help it grow.</p>" +
        "<p>How about a nap in the green bed? In the game, you'll be able to click on an item to offer it to the unhappy alien.</p>" +
        "<p>Let's pretend you offered the alien a nap in the green bed - click Next to see what happens.</p>" +
      "</div>" +
      response_buttons + "</center>"

    var instructions5 = "<center><p> The green alien liked the nap a lot! It is all happy now and it grew by 5 centimeters! </p>" +
      happy_alien +
      response_buttons + "</center>"

    var instructions6 = "<center><p> When you are ready, you can press Next for a practice round of the game.</p>" +
      "<p>Press Previous if you'd like to review the instructions before you start.</p>" +
      aliens +
      "<p>Try to learn which item each alien likes to help them grow!</p></center>"

    var instructions = {
      type: 'instructions',
      pages: [
          welcome_block,
          instructions1,
          instructions2,
          instructions3,
          instructions4,
          instructions5,
          instructions6
      ],
      show_clickable_nav: true,
      timing_post_trial: 200
    }

    var training_block = {
      type: "categorize-alienzzz2",
      season: "training",
      aliens: [green_alien, dblue_alien, purple_alien],
      feedback_amounts: [5, 5, 5],
      choices: [74, 75, 76, 186],
      data: {block: "training"},
      randomize_order: true,
      timing_feedback_duration: 1500,
      timing_response: 10000,
      timeout_message: "<p style='text-align:center; font-size:40px; z=10'>" +
                       "Please respond faster next time! </p>",
      timeline: [
        {key_answer: 0, sad_alien: 0},
        {key_answer: 1, sad_alien: 1},
        {key_answer: 2, sad_alien: 2},
        {key_answer: 0, sad_alien: 0},
        {key_answer: 1, sad_alien: 1},
        {key_answer: 2, sad_alien: 2},
      ]
    }

    var instructions7 =
      "<center><p> Great job! You helped these three aliens grow a lot! </p>" +
      happy_aliens +
      "<p> When you're ready, press Next to move on to the real game. </p>" +
      "<p> This time, you'll be on the aliens' planet, so the seasons will change! " +
      "Keep in mind that the aliens' preferences change with the seasons! </p></center>"

    var instructions_post = {
      type: 'instructions',
      pages: [instructions7],
      show_clickable_nav: true,
      timing_post_trial: 200
    }

    var hot_season = {
      season: "hot",
      feedback_amounts: [3, 2, 1],
      randomize_order: true,
      timeline: [
        {key_answer: 0, sad_alien: 2},
        {key_answer: 1, sad_alien: 1},
        {key_answer: 2, sad_alien: 0},
        {key_answer: 0, sad_alien: 2},
        {key_answer: 1, sad_alien: 1},
        {key_answer: 2, sad_alien: 0},
      ]
    }
    var cold_season = {
      season: "cold",
      feedback_amounts: [5, 4, 6],
      randomize_order: true,
      timeline: [
        {key_answer: 0, sad_alien: 0},
        {key_answer: 1, sad_alien: 2},
        {key_answer: 2, sad_alien: 1},
        {key_answer: 0, sad_alien: 0},
        {key_answer: 1, sad_alien: 2},
        {key_answer: 2, sad_alien: 1},
      ]
    }
    var rainy_season = {
      season: "rainy",
      feedback_amounts: [7, 9, 8],
      randomize_order: true,
      timeline: [
        {key_answer: 0, sad_alien: 1},
        {key_answer: 1, sad_alien: 0},
        {key_answer: 2, sad_alien: 2},
        {key_answer: 0, sad_alien: 1},
        {key_answer: 1, sad_alien: 0},
        {key_answer: 2, sad_alien: 2},
      ]
    }

    var all_seasons = {
      type: "categorize-alienzzz2",
      aliens: shuffle([green_alien, orange_alien, red_alien]),
      choices: [74, 75, 76, 186],
      timing_response: 7000,
      timing_feedback_duration: 750,
      timeout_message: "<p style='text-align:center; font-size:40px; z=10'>" +
                       "Please respond faster next time! </p>",
      // points: [function(){
      //   return
      // }]
      timeline: [
        hot_season, hot_season, hot_season,  // each season has 6 trials
        cold_season, cold_season, cold_season,
        rainy_season, rainy_season, rainy_season,
        hot_season, hot_season,
        cold_season, cold_season,
        rainy_season, rainy_season,
        hot_season,
        cold_season,
        rainy_season
      ]
    }

    var goodbye = {
      type: 'instructions',
      pages: ["<center><p>The game is now over, you did a great job!</p>" +
        "<p>Thank you for participating in the experiment!</p>" +
        "<p>Click Next to finish and download the data!</p></center>"],
      show_clickable_nav: true
    }

    /* create experiment timeline array */
    var timeline = [];
    // timeline.push(welcome_block);
    // timeline.push(get_subj_data);
    // timeline.push(instructions);
    // timeline.push(training_block, training_block, training_block);
    // timeline.push(instructions_post);
    timeline.push(all_seasons);
    timeline.push(goodbye);

    /* start the experiment */
    jsPsych.init({
      timeline: timeline,
      // fullscreen: true,
      // show_progress_bar: true,  // doesn't work when I have a background..
      on_finish: function() {
        jsPsych.data.localSave('test.csv', 'csv')
      }
    });

  </script>
</html>
